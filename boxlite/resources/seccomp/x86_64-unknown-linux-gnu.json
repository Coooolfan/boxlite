{
  "vmm": {
    "default_action": "trap",
    "filter_action": "allow",
    "filter": [
      {
        "syscall": "stat",
        "comment": "Used when creating snapshots in vmm:persist::snapshot_memory_to_file through std::fs::File::metadata"
      },
      {
        "syscall": "epoll_ctl"
      },
      {
        "syscall": "epoll_pwait"
      },
      {
        "syscall": "exit"
      },
      {
        "syscall": "exit_group"
      },
      {
        "syscall": "open"
      },
      {
        "syscall": "read"
      },
      {
        "syscall": "write"
      },
      {
        "syscall": "mincore"
      },
      {
        "syscall": "writev",
        "comment": "Used by the VirtIO net device to write to tap"
      },
      {
        "syscall": "readv",
        "comment": "Used by the VirtIO net device to read from tap"
      },
      {
        "syscall": "fsync"
      },
      {
        "syscall": "close"
      },
      {
        "syscall": "eventfd2",
        "comment": "Used for creating io_uring completion event, on drive patch"
      },
      {
        "syscall": "io_uring_enter",
        "comment": "Used for submitting io_uring requests"
      },
      {
        "syscall": "io_uring_setup",
        "comment": "Used on drive patch"
      },
      {
        "syscall": "io_uring_register",
        "comment": "Used on drive patch"
      },
      {
        "syscall": "brk",
        "comment": "Called for expanding the heap"
      },
      {
        "syscall": "clock_gettime",
        "comment": "Used for metrics and logging, via the helpers in utils/src/time.rs. It's not called on some platforms, because of vdso optimisations."
      },
      {
        "syscall": "connect",
        "comment": "Needed for vsock"
      },
      {
        "syscall": "fstat",
        "comment": "Used for drive patching & rescanning, for reading the local timezone from /etc/localtime"
      },
      {
        "syscall": "ftruncate",
        "comment": "Used for snapshotting"
      },
      {
        "syscall": "lseek",
        "comment": "Used by the block device"
      },
      {
        "syscall": "mremap",
        "comment": "Used for re-allocating large memory regions, for example vectors"
      },
      {
        "syscall": "munmap",
        "comment": "Used for freeing memory"
      },
      {
        "syscall": "recvfrom",
        "comment": "Used by vsock to retrieve data from the socket"
      },
      {
        "syscall": "rt_sigprocmask",
        "comment": "rt_sigprocmask is used by libc::abort during a panic to block and unblock signals"
      },
      {
        "syscall": "rt_sigreturn",
        "comment": "rt_sigreturn is needed in case a fault does occur, so that the signal handler can return. Otherwise we get stuck in a fault loop."
      },
      {
        "syscall": "sigaltstack",
        "comment": "sigaltstack is used by Rust stdlib to remove alternative signal stack during thread teardown."
      },
      {
        "syscall": "getrandom",
        "comment": "getrandom is used by aws-lc library which we consume in virtio-rng"
      },
      {
        "syscall": "accept4",
        "comment": "Called to accept vsock connections",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 524288,
            "comment": "libc::SOCK_CLOEXEC"
          }
        ]
      },
      {
        "syscall": "fcntl",
        "comment": "Used by snapshotting, drive patching and rescanning",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2,
            "comment": "FCNTL_F_SETFD"
          },
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "FCNTL_FD_CLOEXEC"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization (during thread teardown when joining multiple vcpu threads at once)",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 0,
            "comment": "FUTEX_WAIT"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization (during thread teardown)",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "FUTEX_WAKE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 128,
            "comment": "FUTEX_WAIT_PRIVATE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 137,
            "comment": "FUTEX_WAIT_BITSET_PRIVATE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 129,
            "comment": "FUTEX_WAKE_PRIVATE"
          }
        ]
      },
      {
        "syscall": "madvise",
        "comment": "Used by the VirtIO balloon device and by musl for some customer workloads. It is also used by aws-lc during random number generation. They setup a memory page that mark with MADV_WIPEONFORK to be able to detect forks. They also call it with -1 to see if madvise is supported in certain platforms."
      },
      {
        "syscall": "msync",
        "comment": "Used by the VirtIO pmem device to sync the file content with the backing file.",
        "args": [
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 4,
            "comment": "libc::MS_SYNC"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used by the VirtIO balloon device",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 50,
            "comment": "libc::MAP_FIXED | libc::MAP_ANONYMOUS | libc::MAP_PRIVATE"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used for reading the timezone in LocalTime::now()",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "libc::MAP_SHARED"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used by rust's stdlib, particularly when creating a diff snapshot of a VM with ~16 GB of memory",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 34,
            "comment": "libc::MAP_ANONYMOUS | libc::MAP_PRIVATE"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used by io_uring for mapping the queues",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 32769,
            "comment": "libc::MAP_SHARED | libc::MAP_POPULATE"
          }
        ]
      },
      {
        "syscall": "rt_sigaction",
        "comment": "rt_sigaction is used by libc::abort during a panic to install the default handler for SIGABRT",
        "args": [
          {
            "index": 0,
            "type": "dword",
            "op": "eq",
            "val": 6,
            "comment": "SIGABRT"
          }
        ]
      },
      {
        "syscall": "socket",
        "comment": "Called to open the vsock UDS",
        "args": [
          {
            "index": 0,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "libc::AF_UNIX"
          },
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 524289,
            "comment": "libc::SOCK_STREAM | libc::SOCK_CLOEXEC"
          },
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 0
          }
        ]
      },
      {
        "syscall": "tkill",
        "comment": "tkill is used by libc::abort during a panic to raise SIGABRT",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 6,
            "comment": "SIGABRT"
          }
        ]
      },
      {
        "syscall": "tkill",
        "comment": "Used to kick vcpus",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 35,
            "comment": "sigrtmin() + vcpu::VCPU_RTSIG_OFFSET"
          }
        ]
      },
      {
        "syscall": "timerfd_settime",
        "comment": "Needed for rate limiting and metrics",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 0
          }
        ]
      },
      {
        "syscall": "ioctl",
        "comment": "Used to make vsock UDS nonblocking",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 21537,
            "comment": "FIONBIO"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "comment": "Triggered on shutdown, to restore the initial terminal settings.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 21523,
            "comment": "TIOCGWINSZ"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "comment": "Triggered on shutdown, to restore the initial terminal settings, only when Firecracker was launched from a shell.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 21505,
            "comment": "TCGETS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "comment": "Triggered on shutdown, to restore the initial terminal settings, only when Firecracker was launched from a shell.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 21506,
            "comment": "TCSETS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1074835010,
            "comment": "KVM_GET_DIRTY_LOG"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 3255348834,
            "comment": "KVM_GET_IRQCHIP"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2150674044,
            "comment": "KVM_GET_CLOCK"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2154868383,
            "comment": "KVM_GET_PIT2"
          }
        ]
      },
      {
        "syscall": "sched_yield",
        "comment": "Used by the rust standard library in std::sync::mpmc. Firecracker uses mpsc channels from this module for inter-thread communication"
      },
      {
        "syscall": "sendmsg",
        "comment": "Used by vhost-user frontend to communicate with the backend"
      },
      {
        "syscall": "recvmsg",
        "comment": "Used by vhost-user frontend to read response from the backend"
      },
      {
        "syscall": "restart_syscall",
        "comment": "automatically issued by the kernel when specific timing-related syscalls (e.g. nanosleep) get interrupted by SIGSTOP"
      },

      {
        "syscall": "openat",
        "comment": "libkrun: glibc 2.26+ maps open() to openat(AT_FDCWD, ...). Required at steady-state."
      },
      {
        "syscall": "newfstatat",
        "comment": "libkrun: glibc 2.33+ maps stat/fstat to newfstatat. Required at steady-state."
      },
      {
        "syscall": "statx",
        "comment": "libkrun: modern file stat (glibc 2.38+). Required at steady-state."
      },
      {
        "syscall": "readlinkat",
        "comment": "libkrun: modern readlink (glibc uses readlinkat). TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "unlinkat",
        "comment": "libkrun: modern unlink (glibc uses unlinkat). TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "clone3",
        "comment": "libkrun: vCPU thread creation (glibc 2.34+ uses clone3). Required at steady-state."
      },
      {
        "syscall": "clone",
        "comment": "libkrun: vCPU thread creation (legacy clone, fallback for older glibc). Required at steady-state."
      },
      {
        "syscall": "close_range",
        "comment": "libkrun: close range of file descriptors (glibc 2.34+). Required at steady-state."
      },
      {
        "syscall": "epoll_create1",
        "comment": "libkrun: create epoll instance for I/O multiplexing. Required at steady-state."
      },
      {
        "syscall": "epoll_wait",
        "comment": "libkrun: epoll wait for I/O multiplexing. Required at steady-state."
      },
      {
        "syscall": "mprotect",
        "comment": "libkrun: memory protection changes for guest RAM regions. Required at steady-state."
      },
      {
        "syscall": "bind",
        "comment": "libkrun: bind socket for tonic gRPC vsock server. Required at steady-state."
      },
      {
        "syscall": "listen",
        "comment": "libkrun: listen on socket for tonic gRPC vsock server. Required at steady-state."
      },
      {
        "syscall": "getsockname",
        "comment": "libkrun: get socket address for tonic gRPC vsock server. Required at steady-state."
      },
      {
        "syscall": "setsockopt",
        "comment": "libkrun: set socket options for tonic gRPC vsock server. Required at steady-state."
      },
      {
        "syscall": "sendto",
        "comment": "libkrun: send data on socket for networking. Required at steady-state."
      },
      {
        "syscall": "poll",
        "comment": "libkrun: I/O multiplexing for event loop. Required at steady-state."
      },
      {
        "syscall": "pread64",
        "comment": "libkrun: positioned read for block device I/O. Required at steady-state."
      },
      {
        "syscall": "pwrite64",
        "comment": "libkrun: positioned write for block device I/O. Required at steady-state."
      },
      {
        "syscall": "preadv",
        "comment": "libkrun: vectorized positioned read for block device I/O. Required at steady-state."
      },
      {
        "syscall": "mkdir",
        "comment": "libkrun: directory creation during VM setup. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "dup",
        "comment": "libkrun: file descriptor duplication. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "dup2",
        "comment": "libkrun: file descriptor duplication. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "kill",
        "comment": "libkrun: signal delivery for VM lifecycle management. Required at steady-state."
      },
      {
        "syscall": "capget",
        "comment": "libkrun: query process capabilities during setup. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "prctl",
        "comment": "libkrun: thread setup (PR_SET_NAME, etc.). Required at steady-state for vCPU thread naming."
      },
      {
        "syscall": "pipe2",
        "comment": "libkrun: pipe creation for internal IPC. Required at steady-state."
      },
      {
        "syscall": "tgkill",
        "comment": "libkrun: thread-group signal delivery for VM lifecycle. Required at steady-state."
      },
      {
        "syscall": "nanosleep",
        "comment": "libkrun: sleep operations for timing. Required at steady-state."
      },
      {
        "syscall": "clock_nanosleep",
        "comment": "libkrun: precise sleep (glibc maps nanosleep to clock_nanosleep). Required at steady-state."
      },
      {
        "syscall": "getpid",
        "comment": "libkrun: get process ID. Required at steady-state."
      },
      {
        "syscall": "gettid",
        "comment": "libkrun: get thread ID for vCPU thread init. Required at steady-state."
      },
      {
        "syscall": "getuid",
        "comment": "libkrun: get user ID. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "getgid",
        "comment": "libkrun: get group ID. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "access",
        "comment": "libkrun: check file access permissions. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "arch_prctl",
        "comment": "libkrun: x86_64 TLS setup (called by new threads via clone). TODO(seccomp): needed per-thread, but only during thread init."
      },
      {
        "syscall": "set_robust_list",
        "comment": "libkrun: pthread robust futex list (called by new threads). TODO(seccomp): needed per-thread, but only during thread init."
      },
      {
        "syscall": "set_tid_address",
        "comment": "libkrun: set thread ID pointer (called by new threads). TODO(seccomp): needed per-thread, but only during thread init."
      },
      {
        "syscall": "rseq",
        "comment": "libkrun: restartable sequences (glibc 2.35+). TODO(seccomp): needed per-thread, but only during thread init."
      },
      {
        "syscall": "prlimit64",
        "comment": "libkrun: get/set resource limits. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "sched_getaffinity",
        "comment": "libkrun: CPU affinity query for vCPU scheduling. Required at steady-state."
      },
      {
        "syscall": "umask",
        "comment": "libkrun: set file creation mask (used by libcontainer). TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "accept",
        "comment": "libkrun: accept connections (older variant without flags). Required at steady-state for tonic gRPC."
      },
      {
        "syscall": "capset",
        "comment": "libkrun: set process capabilities during setup. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "copy_file_range",
        "comment": "libkrun: efficient file copy. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "fchmod",
        "comment": "libkrun: change file permissions. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "flock",
        "comment": "libkrun: file locking. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "getcwd",
        "comment": "libkrun: get current working directory. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "getdents64",
        "comment": "libkrun: read directory entries. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "geteuid",
        "comment": "libkrun: get effective user ID. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "getsockopt",
        "comment": "libkrun: get socket options for tonic gRPC vsock server. Required at steady-state."
      },
      {
        "syscall": "mkdirat",
        "comment": "libkrun: create directory relative to fd. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "pwritev",
        "comment": "libkrun: vectorized positioned write for block device I/O. Required at steady-state."
      },
      {
        "syscall": "readlink",
        "comment": "libkrun: read symbolic link. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "shutdown",
        "comment": "libkrun: shutdown socket for tonic gRPC. Required at steady-state."
      },
      {
        "syscall": "signalfd4",
        "comment": "libkrun: create signalfd for signal handling. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "socketpair",
        "comment": "libkrun: create connected socket pair for internal IPC. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "uname",
        "comment": "libkrun: get system info. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "unlink",
        "comment": "libkrun: delete file. TODO(seccomp): likely setup-only, may be removable after audit."
      },
      {
        "syscall": "wait4",
        "comment": "libkrun: wait for child process. Required at steady-state."
      },
      {
        "syscall": "waitid",
        "comment": "libkrun: wait for child process (extended). Required at steady-state."
      },

      {
        "syscall": "ioctl",
        "comment": "TODO(seccomp): overly broad — replace with explicit KVM ioctl codes once libkrun's full set is audited. Firecracker enumerates each KVM_* code individually. Currently catch-all because libkrun uses 28+ distinct KVM ioctls during VM setup and runtime.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any ioctl request code"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "TODO(seccomp): overly broad — replace with explicit MAP_* flag combinations once libkrun's mmap usage is audited. Currently catch-all because libkrun uses MAP_SHARED, MAP_PRIVATE|MAP_ANONYMOUS, MAP_FIXED, and more for guest RAM, balloon, and I/O regions.",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any mmap flags"
          }
        ]
      },
      {
        "syscall": "socket",
        "comment": "TODO(seccomp): overly broad — replace with explicit AF_UNIX/AF_INET/AF_INET6 rules once libkrun's socket usage is audited. Currently catch-all because libkrun uses various domain/type/protocol combinations for vsock and networking.",
        "args": [
          {
            "index": 0,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any socket domain"
          }
        ]
      },
      {
        "syscall": "fcntl",
        "comment": "TODO(seccomp): overly broad — replace with explicit F_GETFD/F_SETFD/F_GETFL/F_SETFL rules. Currently catch-all because libkrun uses multiple fcntl commands for FD management.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any fcntl command"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "TODO(seccomp): overly broad — replace with explicit FUTEX_WAIT/WAKE/WAIT_PRIVATE/WAKE_PRIVATE/WAIT_BITSET_PRIVATE rules once libkrun's futex ops are audited. Currently catch-all because seccompiler silently drops unconditional entries when conditional entries exist for the same syscall.",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any futex op"
          }
        ]
      },
      {
        "syscall": "rt_sigaction",
        "comment": "TODO(seccomp): overly broad — replace with explicit signal numbers (SIGABRT, SIGSEGV, SIGBUS, etc.) once libkrun's signal set is known. Currently catch-all because libkrun registers handlers for multiple signals during VM setup.",
        "args": [
          {
            "index": 0,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any signal number"
          }
        ]
      },
      {
        "syscall": "accept4",
        "comment": "TODO(seccomp): overly broad — replace with explicit SOCK_CLOEXEC rule once libkrun's accept4 flags are confirmed. Currently catch-all for compatibility.",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "ge",
            "val": 0,
            "comment": "any accept4 flags"
          }
        ]
      }
    ]
  },
  "api": {
    "default_action": "trap",
    "filter_action": "allow",
    "filter": [
      {
        "syscall": "epoll_ctl"
      },
      {
        "syscall": "epoll_pwait"
      },
      {
        "syscall": "exit"
      },
      {
        "syscall": "exit_group"
      },
      {
        "syscall": "open"
      },
      {
        "syscall": "read"
      },
      {
        "syscall": "write"
      },
      {
        "syscall": "close"
      },
      {
        "syscall": "brk",
        "comment": "Called for expanding the heap"
      },
      {
        "syscall": "clock_gettime",
        "comment": "Used for metrics and logging, via the helpers in utils/src/time.rs. It's not called on some platforms, because of vdso optimisations."
      },
      {
        "syscall": "fstat",
        "comment": "Used for reading the local timezone from /etc/localtime"
      },
      {
        "syscall": "mremap",
        "comment": "Used for re-allocating large memory regions, for example vectors"
      },
      {
        "syscall": "munmap",
        "comment": "Used for freeing memory"
      },
      {
        "syscall": "recvfrom",
        "comment": "Used to retrieve data from the socket"
      },
      {
        "syscall": "recvmsg",
        "comment": "Needed by micro-http to read from the byte stream."
      },
      {
        "syscall": "rt_sigprocmask",
        "comment": "rt_sigprocmask is used by Rust stdlib to remove custom signal handler during thread teardown."
      },
      {
        "syscall": "sigaltstack",
        "comment": "sigaltstack is used by Rust stdlib to remove alternative signal stack during thread teardown."
      },
      {
        "syscall": "getrandom",
        "comment": "getrandom is used by `HttpServer` to reinialize `HashMap` after moving to the API thread"
      },
      {
        "syscall": "accept4",
        "comment": "Called to accept socket connections",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 524288,
            "comment": "libc::SOCK_CLOEXEC"
          }
        ]
      },
      {
        "syscall": "fcntl",
        "comment": "Used by MMDS version 2 to extract entropy",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2,
            "comment": "FCNTL_F_SETFD"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization (during thread teardown)",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 0,
            "comment": "FUTEX_WAIT"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization (during thread teardown)",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "FUTEX_WAKE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 128,
            "comment": "FUTEX_WAIT_PRIVATE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 137,
            "comment": "FUTEX_WAIT_BITSET_PRIVATE"
          }
        ]
      },
      {
        "syscall": "futex",
        "comment": "Used for synchronization",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 129,
            "comment": "FUTEX_WAKE_PRIVATE"
          }
        ]
      },
      {
        "syscall": "madvise",
        "comment": "Triggered by musl for some customer workloads",
        "args": [
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 4,
            "comment": "libc::MADV_DONTNEED"
          }
        ]
      },
      {
        "syscall": "madvise",
        "comment": "Triggered on some deallocation paths in musl free()",
        "args": [
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 8,
            "comment": "libc::MADV_FREE"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used for large buffers sent to api_server",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 34,
            "comment": "libc::MAP_ANONYMOUS | libc::MAP_PRIVATE"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used for reading the timezone in LocalTime::now()",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "libc::MAP_SHARED"
          }
        ]
      },
      {
        "syscall": "rt_sigaction",
        "comment": "libkrun: signal handler registration (SIGABRT, SIGSEGV, etc.)"
      },
      {
        "syscall": "socket",
        "comment": "Called to open the unix domain socket",
        "args": [
          {
            "index": 0,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "libc::AF_UNIX"
          },
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 524289,
            "comment": "libc::SOCK_STREAM | libc::SOCK_CLOEXEC"
          },
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 0
          }
        ]
      },
      {
        "syscall": "tkill",
        "comment": "tkill is used by libc::abort during a panic to raise SIGABRT",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 6,
            "comment": "SIGABRT"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "comment": "Used to make api socket nonblocking",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 21537,
            "comment": "FIONBIO"
          }
        ]
      },
      {
        "syscall": "sched_yield",
        "comment": "Used by the rust standard library in std::sync::mpmc. Firecracker uses mpsc channels from this module for inter-thread communication"
      },
      {
        "syscall": "restart_syscall",
        "comment": "automatically issued by the kernel when specific timing-related syscalls (e.g. nanosleep) get interrupted by SIGSTOP"
      }
    ]
  },
  "vcpu": {
    "default_action": "trap",
    "filter_action": "allow",
    "filter": [
      {
        "syscall": "exit"
      },
      {
        "syscall": "exit_group"
      },
      {
        "syscall": "write"
      },
      {
        "syscall": "open"
      },
      {
        "syscall": "close"
      },
      {
        "syscall": "fstat",
        "comment": "Used for reading the local timezone from /etc/localtime"
      },
      {
        "syscall": "brk",
        "comment": "Called for expanding the heap"
      },
      {
        "syscall": "clock_gettime",
        "comment": "Used for metrics and logging, via the helpers in utils/src/time.rs. It's not called on some platforms, because of vdso optimisations."
      },
      {
        "syscall": "mremap",
        "comment": "Used for re-allocating large memory regions, for example vectors"
      },
      {
        "syscall": "munmap",
        "comment": "Used for freeing memory"
      },
      {
        "syscall": "rt_sigprocmask",
        "comment": "rt_sigprocmask is used by Rust stdlib to remove custom signal handler during thread teardown."
      },
      {
        "syscall": "rt_sigreturn",
        "comment": "rt_sigreturn is needed in case a fault does occur, so that the signal handler can return. Otherwise we get stuck in a fault loop."
      },
      {
        "syscall": "sigaltstack",
        "comment": "sigaltstack is used by Rust stdlib to remove alternative signal stack during thread teardown."
      },
      {
        "syscall": "futex",
        "comment": "libkrun: thread synchronization (WAIT, WAKE, WAIT_PRIVATE, WAKE_PRIVATE, WAIT_BITSET)"
      },
      {
        "syscall": "madvise",
        "comment": "Triggered by musl for some customer workloads",
        "args": [
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 4,
            "comment": "libc::MADV_DONTNEED"
          }
        ]
      },
      {
        "syscall": "madvise",
        "comment": "Triggered on some deallocation paths in musl free()",
        "args": [
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 8,
            "comment": "libc::MADV_FREE"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used for reading the timezone in LocalTime::now()",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 1,
            "comment": "libc::MAP_SHARED"
          }
        ]
      },
      {
        "syscall": "mmap",
        "comment": "Used for allocating memory for FamStructWrapper called by KvmCpu::get_cpuid",
        "args": [
          {
            "index": 3,
            "type": "dword",
            "op": "eq",
            "val": 34,
            "comment": "libc::MAP_ANONYMOUS|libc::MAP_PRIVATE"
          },
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 3,
            "comment": "libc::PROT_READ|libc::PROT_WRITE"
          }
        ]
      },
      {
        "syscall": "rt_sigaction",
        "comment": "libkrun: signal handler registration (SIGABRT, SIGSEGV, etc.)"
      },
      {
        "syscall": "timerfd_settime",
        "comment": "Needed for updating the balloon statistics interval",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 0
          }
        ]
      },
      {
        "syscall": "tkill",
        "comment": "tkill is used by libc::abort during a panic to raise SIGABRT",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 6,
            "comment": "SIGABRT"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 44672,
            "comment": "KVM_RUN"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2147790488,
            "comment": "KVM_GET_MP_STATE"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2151722655,
            "comment": "KVM_GET_VCPU_EVENTS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2214637198,
            "comment": "KVM_GET_LAPIC"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2167975555,
            "comment": "KVM_GET_SREGS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2156965505,
            "comment": "KVM_GET_REGS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 3221794440,
            "comment": "KVM_GET_MSRS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 3221794449,
            "comment": "KVM_GET_CPUID2"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2155916961,
            "comment": "KVM_GET_DEBUGREGS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2415963812,
            "comment": "KVM_GET_XSAVE"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2415963855,
            "comment": "KVM_GET_XSAVE2"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 2173218470,
            "comment": "KVM_GET_XCRS"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 44707,
            "comment": "KVM_GET_TSC_KHZ"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1074025680,
            "comment": "TUNSETOFFLOAD"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 44717,
            "comment": "KVM_KVMCLOCK_CTRL. We call this after pausing vCPUs to avoid soft lockups in the guest."
          }
        ]
      },
      {
        "syscall": "sched_yield",
        "comment": "Used by the rust standard library in std::sync::mpmc. Firecracker uses mpsc channels from this module for inter-thread communication"
      },
      {
        "syscall": "sendmsg",
        "comment": "Used by vhost-user frontend to communicate with the backend"
      },
      {
        "syscall": "restart_syscall",
        "comment": "automatically issued by the kernel when specific timing-related syscalls (e.g. nanosleep) get interrupted by SIGSTOP"
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 44547,
            "comment": "KVM_CHECK_EXTENSION"
          },
          {
            "index": 2,
            "type": "dword",
            "op": "eq",
            "val": 131,
            "comment": "KVM_CAP_MSI_DEVID"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1074310762,
            "comment": "KVM_SET_GSI_ROUTING"
          }
        ]
      },
      {
        "syscall": "ioctl",
        "args": [
          {
            "index": 1,
            "type": "dword",
            "op": "eq",
            "val": 1075883638,
            "comment": "KVM_IRQFD"
          }
        ]
      }
    ]
  }
}
